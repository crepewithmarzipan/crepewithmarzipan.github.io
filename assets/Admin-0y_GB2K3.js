const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-BqeNKh0y.js","assets/_commonjsHelpers-BosuxZz1.js"])))=>i.map(i=>d[i]);
import{d as ne,r as u,c as d,C as n,j as C,D as I,H as se,I as ae,G as j,k as P,F as oe,u as ie,_ as le,b as p}from"./index-Cvlx_MuR.js";import{g as k,a as B,s as _,_ as re}from"./persistence-B2x302V5.js";const b={};function O(){const r=b==null?void 0:b.VITE_API_BASE;return r&&r.trim().length?r.trim().replace(/\/$/,""):null}function ce(){const r=String((b==null?void 0:b.VITE_REMOTE_ROSTER)??"").trim();return!!O()||r==="1"||/^true$/i.test(r)}async function ue(){const r=O();if(!r)throw new Error("VITE_API_BASE not set");const h=await fetch(`${r}/api/roster`,{method:"GET",headers:{Accept:"application/json"}});if(!h.ok)throw new Error(`fetch roster failed: ${h.status}`);const c=await h.json();return(Array.isArray(c==null?void 0:c.roster)?c.roster:[]).filter(m=>m&&typeof m.name=="string"&&typeof m.id=="string")}async function de(r,h){const c=O();if(!c)throw new Error("VITE_API_BASE not set");const a=await fetch(`${c}/api/roster`,{method:"PUT",headers:{"Content-Type":"application/json",Accept:"application/json","x-admin-token":h||""},body:JSON.stringify({roster:r})});if(!a.ok){const m=await a.text().catch(()=>"");throw new Error(`save roster failed: ${a.status} ${m}`)}}const pe={class:"admin"},me={key:0,class:"gate"},ve={class:"row"},fe={key:1,class:"section"},he={class:"grid"},we={class:"panel"},ge={class:"list"},ye={key:0,class:"empty"},ke={class:"meta"},be=["title"],Ae=["title"],Se=["onClick"],Ce={key:1,class:"fixed",title:"Immer vorhanden"},Ie={class:"panel"},_e={class:"row"},xe={class:"row"},Ee=["disabled"],Re={key:0},Ne={class:"row"},Te={key:0,class:"row",style:{"margin-top":"12px"}},ze=["disabled"],Le=["disabled"],je={key:0,class:"muted"},Pe=ne({__name:"Admin",setup(r){const h=u(sessionStorage.getItem("ti.admin.ok")==="1"),c=u(""),a=u(k().filter(t=>t.id.toLowerCase()!=="crepewithmarzipan")),m=u(""),x=u(""),E=u(""),R=u([]),v=u(!1);let A=null;const N=u(ce()),T=u(""),f=u("");function V(){if(c.value===String("2410"))h.value=!0,sessionStorage.setItem("ti.admin.ok","1"),N.value&&U();else try{window.alert("Falscher PIN")}catch{}}function S(t){return t.replace(/^@+/,"").trim()}function J(){const t=m.value.trim(),e=S(x.value);!t||!e||e.toLowerCase()!=="crepewithmarzipan"&&(B([{name:t,id:e}]),a.value=k().filter(s=>s.id.toLowerCase()!=="crepewithmarzipan"),m.value="",x.value="")}function $(t){const s=t.split(/\r?\n/).map(i=>i.trim()).filter(i=>i.length>0),o=[],l=i=>/^[A-Za-z0-9._-]+$/.test(i);for(let i=0;i<s.length;i++){const y=s[i];if(y.includes(",")){const w=y.split(",");if(w.length===2){const g=String(w[0]??"").trim(),L=String(w[1]??"").trim(),F=S(L);if(g&&l(F)){o.push({name:g,id:F});continue}}}if(i+1<s.length){const w=s[i+1],g=S(w);if(l(g)){o.push({name:y,id:g}),i++;continue}}const z=y.split(/[\t ]+/);if(z.length>=2){const w=S(z[z.length-1]||"");if(l(w)){const g=z.slice(0,-1).join(" ").trim(),L=w;if(g&&L){o.push({name:g,id:L});continue}}}o.push({name:y,id:S(y)})}return o}function H(){const t=$(E.value);if(!t.length)return;const e=t.filter(s=>s.id.toLowerCase()!=="crepewithmarzipan");B(e),a.value=k().filter(s=>s.id.toLowerCase()!=="crepewithmarzipan")}function G(){E.value=""}function M(t){const e=t.target;R.value=Array.from(e.files||[])}async function Z(){if(R.value.length){if(!A)try{A=await le(()=>import("./index-BqeNKh0y.js").then(t=>t.i),__vite__mapDeps([0,1]))}catch{A=null}if(A){v.value=!0;try{const t=[];for(const l of R.value){const{data:i}=await A.recognize(l,"eng");t.push((i==null?void 0:i.text)||"")}const s=t.join(`
`).replace(/[@#]/g,"").replace(/[^\p{L}\p{N} _.,\n\-]/gu," "),o=$(s);B(o),a.value=k()}finally{v.value=!1}}}}function K(t){a.value.splice(t,1),_([{name:"crepewithmarzipan",id:"crepewithmarzipan"},...a.value])}async function W(){_(a.value);try{await q()}catch{}try{D()}catch{}}async function q(){const t=window;if(!t.showSaveFilePicker)throw new Error("no-fs-api");const e={roster:a.value},s=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),l=await(await t.showSaveFilePicker({suggestedName:"roster.json",types:[{description:"JSON",accept:{"application/json":[".json"]}}]})).createWritable();await l.write(s),await l.close()}function Q(){a.value=k()}function X(){a.value=[],_([])}function D(){const t={roster:a.value},e=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),s=URL.createObjectURL(e),o=document.createElement("a");o.href=s,o.download="roster.json",document.body.appendChild(o),o.click(),setTimeout(()=>{URL.revokeObjectURL(s),document.body.removeChild(o)},0)}function Y(t){const e=t.target,s=e.files&&e.files[0];if(!s)return;const o=new FileReader;o.onload=()=>{try{const l=JSON.parse(String(o.result||"{}")),i=Array.isArray(l==null?void 0:l.roster)?l.roster:[];i.length&&(_(i),a.value=k())}catch{}},o.readAsText(s)}async function U(){if(N.value){v.value=!0,f.value="Lade Server-Roster…";try{const t=await ue();Array.isArray(t)&&t.length?(a.value=t,_(t),f.value=`Geladen (${t.length})`):f.value="Server-Roster leer"}catch(t){f.value=`Fehler: ${(t==null?void 0:t.message)||t}`}finally{v.value=!1}}}async function ee(){if(N.value){v.value=!0,f.value="Speichere zum Server…";try{await de(a.value,T.value),f.value="Gespeichert."}catch(t){f.value=`Fehler: ${(t==null?void 0:t.message)||t}`}finally{v.value=!1}}}function te(){const t=[{name:"crepewithmarzipan",id:"crepewithmarzipan"},...a.value],e=new CustomEvent("ti:applyRoster",{detail:{roster:t}});window.dispatchEvent(e)}return(t,e)=>(p(),d("div",pe,[e[14]||(e[14]=n("h1",null,"Admin",-1)),h.value?(p(),d("section",fe,[e[13]||(e[13]=n("h2",null,"Roster",-1)),n("div",he,[n("div",we,[e[7]||(e[7]=ae('<h3 data-v-71a45d52>Mein Profil (immer vorhanden)</h3><div class="list" data-v-71a45d52><div class="item" data-v-71a45d52><div class="meta" data-v-71a45d52><strong class="name" data-v-71a45d52>crepewithmarzipan</strong><small class="id" data-v-71a45d52>crepewithmarzipan</small></div><span class="fixed" title="Immer vorhanden" data-v-71a45d52>fixiert</span></div></div><h3 style="margin-top:12px;" data-v-71a45d52>Andere</h3>',3)),n("h3",null,"Aktuelle Liste ("+j(a.value.length)+")",1),n("div",ge,[a.value.length?P("",!0):(p(),d("div",ye,"Noch keine Einträge. Füge oben Personen hinzu.")),(p(!0),d(oe,null,ie(a.value,(s,o)=>(p(),d("div",{key:s.id+":"+o,class:"item"},[n("div",ke,[n("strong",{class:"name",title:s.name},j(s.name),9,be),n("small",{class:"id",title:s.id},j(s.id),9,Ae)]),s.id!=="crepewithmarzipan"?(p(),d("button",{key:0,class:"remove",onClick:l=>K(o),title:"Entfernen"},"✕",8,Se)):(p(),d("span",Ce,"fixiert"))]))),128))])]),n("div",Ie,[e[8]||(e[8]=n("h3",null,"Hinzufügen",-1)),n("div",_e,[C(n("input",{"onUpdate:modelValue":e[1]||(e[1]=s=>m.value=s),placeholder:"Name"},null,512),[[I,m.value]]),C(n("input",{"onUpdate:modelValue":e[2]||(e[2]=s=>x.value=s),placeholder:"ID/Handle"},null,512),[[I,x.value]]),n("button",{onClick:J},"Hinzufügen")]),e[9]||(e[9]=n("small",{class:"muted"},"Duplikate werden anhand der ID entfernt.",-1)),e[10]||(e[10]=n("h3",{style:{"margin-top":"16px"}},"Bulk",-1)),C(n("textarea",{"onUpdate:modelValue":e[3]||(e[3]=s=>E.value=s),rows:"10",placeholder:"Unterstützte Formate:\\n• Name,ID\\n• Name ID\\n• Zwei Zeilen: Name\\n  nächste Zeile: ID\\n\\nBeispiel:\\nAlice\\nalice_id\\n\\nBob, bob_id"},null,512),[[I,E.value]]),n("div",{class:"row"},[n("button",{onClick:H},"Importieren"),n("button",{onClick:G},"Leeren")]),e[11]||(e[11]=n("h3",{style:{"margin-top":"16px"}},"OCR (Screenshots)",-1)),n("div",xe,[n("input",{type:"file",accept:"image/*",multiple:"",onChange:M},null,32),n("button",{disabled:v.value||R.value.length===0,onClick:Z},"OCR starten",8,Ee),v.value?(p(),d("span",Re,"…erkenne Text…")):P("",!0)]),n("div",{class:"row",style:{"margin-top":"12px"}},[n("button",{onClick:W},"Speichern"),n("button",{onClick:Q},"Laden"),n("button",{onClick:X},"Alles löschen"),n("button",{class:"apply",onClick:te},"Auf App anwenden")]),e[12]||(e[12]=n("h3",{style:{"margin-top":"16px"}},"Export/Import JSON",-1)),n("div",Ne,[n("button",{onClick:D},"Als roster.json herunterladen"),n("input",{type:"file",accept:"application/json",onChange:Y},null,32)]),N.value?(p(),d("div",Te,[C(n("input",{"onUpdate:modelValue":e[4]||(e[4]=s=>T.value=s),placeholder:"Admin-Token (vom Server)"},null,512),[[I,T.value]]),n("button",{disabled:v.value,onClick:U},"Server laden",8,ze),n("button",{disabled:v.value||!T.value,onClick:ee},"Server speichern",8,Le),f.value?(p(),d("small",je,j(f.value),1)):P("",!0)])):P("",!0)])])])):(p(),d("div",me,[e[5]||(e[5]=n("h2",null,"Admin PIN",-1)),n("div",ve,[C(n("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>c.value=s),type:"password",placeholder:"PIN",onKeyup:se(V,["enter"])},null,544),[[I,c.value]]),n("button",{onClick:V},"Öffnen")]),e[6]||(e[6]=n("small",{class:"muted"},'Setze VITE_ADMIN_PIN in .env.local (Standard: "admin").',-1))]))]))}}),Ve=re(Pe,[["__scopeId","data-v-71a45d52"]]);export{Ve as default};
