const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-BqeNKh0y.js","assets/_commonjsHelpers-BosuxZz1.js"])))=>i.map(i=>d[i]);
import{d as te,r as c,c as d,C as t,j as I,D as S,H as ne,G as j,k as O,F as se,u as oe,_ as le,b as p}from"./index-Ba5RGYwb.js";import{g as w,a as P,s as C,_ as ie}from"./persistence-B2x302V5.js";const b={};function V(){const a=b==null?void 0:b.VITE_API_BASE;return a&&a.trim().length?a.trim().replace(/\/$/,""):null}function ae(){const a=String((b==null?void 0:b.VITE_REMOTE_ROSTER)??"").trim();return!!V()||a==="1"||/^true$/i.test(a)}async function re(){const a=V();if(!a)throw new Error("VITE_API_BASE not set");const h=await fetch(`${a}/api/roster`,{method:"GET",headers:{Accept:"application/json"}});if(!h.ok)throw new Error(`fetch roster failed: ${h.status}`);const r=await h.json();return(Array.isArray(r==null?void 0:r.roster)?r.roster:[]).filter(m=>m&&typeof m.name=="string"&&typeof m.id=="string")}async function ue(a,h){const r=V();if(!r)throw new Error("VITE_API_BASE not set");const o=await fetch(`${r}/api/roster`,{method:"PUT",headers:{"Content-Type":"application/json",Accept:"application/json","x-admin-token":h||""},body:JSON.stringify({roster:a})});if(!o.ok){const m=await o.text().catch(()=>"");throw new Error(`save roster failed: ${o.status} ${m}`)}}const ce={class:"admin"},de={key:0,class:"gate"},pe={class:"row"},me={key:1,class:"section"},ve={class:"grid"},fe={class:"panel"},he={class:"list"},ge={key:0,class:"empty"},ye={class:"meta"},ke=["title"],we=["title"],be=["onClick"],Ae={key:1,class:"fixed",title:"Immer vorhanden"},_e={class:"panel"},Ie={class:"row"},Se={class:"row"},Ce=["disabled"],Ee={key:0},Re={class:"row"},xe={key:0,class:"row",style:{"margin-top":"12px"}},Te=["disabled"],Ne=["disabled"],Be={key:0,class:"muted"},Le=te({__name:"Admin",setup(a){const h=c(sessionStorage.getItem("ti.admin.ok")==="1"),r=c(""),o=c(w()),m=c(""),E=c(""),R=c(""),x=c([]),v=c(!1);let A=null;const T=c(ae()),N=c(""),f=c("");function $(){if(r.value===String("2410"))h.value=!0,sessionStorage.setItem("ti.admin.ok","1"),T.value&&U();else try{window.alert("Falscher PIN")}catch{}}function _(e){return e.replace(/^@+/,"").trim()}function F(){const e=m.value.trim(),n=_(E.value);!e||!n||(P([{name:e,id:n}]),o.value=w(),m.value="",E.value="")}function D(e){const s=e.split(/\r?\n/).map(i=>i.trim()).filter(i=>i.length>0),l=[],u=i=>/^[A-Za-z0-9._-]+$/.test(i);for(let i=0;i<s.length;i++){const k=s[i];if(k.includes(",")){const g=k.split(",");if(g.length===2){const y=String(g[0]??"").trim(),L=String(g[1]??"").trim(),z=_(L);if(y&&u(z)){l.push({name:y,id:z});continue}}}if(i+1<s.length){const g=s[i+1],y=_(g);if(u(y)){l.push({name:k,id:y}),i++;continue}}const B=k.split(/[\t ]+/);if(B.length>=2){const g=_(B[B.length-1]||"");if(u(g)){const y=B.slice(0,-1).join(" ").trim(),L=g;if(y&&L){l.push({name:y,id:L});continue}}}l.push({name:k,id:_(k)})}return l}function J(){const e=D(R.value);e.length&&(P(e),o.value=w())}function H(){R.value=""}function G(e){const n=e.target;x.value=Array.from(n.files||[])}async function Z(){if(x.value.length){if(!A)try{A=await le(()=>import("./index-BqeNKh0y.js").then(e=>e.i),__vite__mapDeps([0,1]))}catch{A=null}if(A){v.value=!0;try{const e=[];for(const u of x.value){const{data:i}=await A.recognize(u,"eng");e.push((i==null?void 0:i.text)||"")}const s=e.join(`
`).replace(/[@#]/g,"").replace(/[^\p{L}\p{N} _.,\n\-]/gu," "),l=D(s);P(l),o.value=w()}finally{v.value=!1}}}}function M(e){o.value.splice(e,1),C(o.value)}function K(){C(o.value)}function q(){o.value=w()}function Q(){o.value=[],C([])}function W(){const e={roster:o.value},n=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),s=URL.createObjectURL(n),l=document.createElement("a");l.href=s,l.download="roster.json",document.body.appendChild(l),l.click(),setTimeout(()=>{URL.revokeObjectURL(s),document.body.removeChild(l)},0)}function X(e){const n=e.target,s=n.files&&n.files[0];if(!s)return;const l=new FileReader;l.onload=()=>{try{const u=JSON.parse(String(l.result||"{}")),i=Array.isArray(u==null?void 0:u.roster)?u.roster:[];i.length&&(C(i),o.value=w())}catch{}},l.readAsText(s)}async function U(){if(T.value){v.value=!0,f.value="Lade Server-Roster…";try{const e=await re();Array.isArray(e)&&e.length?(o.value=e,C(e),f.value=`Geladen (${e.length})`):f.value="Server-Roster leer"}catch(e){f.value=`Fehler: ${(e==null?void 0:e.message)||e}`}finally{v.value=!1}}}async function Y(){if(T.value){v.value=!0,f.value="Speichere zum Server…";try{await ue(o.value,N.value),f.value="Gespeichert."}catch(e){f.value=`Fehler: ${(e==null?void 0:e.message)||e}`}finally{v.value=!1}}}function ee(){const e=new CustomEvent("ti:applyRoster",{detail:{roster:o.value.slice()}});window.dispatchEvent(e)}return(e,n)=>(p(),d("div",ce,[n[13]||(n[13]=t("h1",null,"Admin",-1)),h.value?(p(),d("section",me,[n[12]||(n[12]=t("h2",null,"Roster",-1)),t("div",ve,[t("div",fe,[t("h3",null,"Aktuelle Liste ("+j(o.value.length)+")",1),t("div",he,[o.value.length?O("",!0):(p(),d("div",ge,"Noch keine Einträge. Füge oben Personen hinzu.")),(p(!0),d(se,null,oe(o.value,(s,l)=>(p(),d("div",{key:s.id+":"+l,class:"item"},[t("div",ye,[t("strong",{class:"name",title:s.name},j(s.name),9,ke),t("small",{class:"id",title:s.id},j(s.id),9,we)]),s.id!=="crepewithmarzipan"?(p(),d("button",{key:0,class:"remove",onClick:u=>M(l),title:"Entfernen"},"✕",8,be)):(p(),d("span",Ae,"fixiert"))]))),128))])]),t("div",_e,[n[7]||(n[7]=t("h3",null,"Hinzufügen",-1)),t("div",Ie,[I(t("input",{"onUpdate:modelValue":n[1]||(n[1]=s=>m.value=s),placeholder:"Name"},null,512),[[S,m.value]]),I(t("input",{"onUpdate:modelValue":n[2]||(n[2]=s=>E.value=s),placeholder:"ID/Handle"},null,512),[[S,E.value]]),t("button",{onClick:F},"Hinzufügen")]),n[8]||(n[8]=t("small",{class:"muted"},"Duplikate werden anhand der ID entfernt.",-1)),n[9]||(n[9]=t("h3",{style:{"margin-top":"16px"}},"Bulk",-1)),I(t("textarea",{"onUpdate:modelValue":n[3]||(n[3]=s=>R.value=s),rows:"10",placeholder:"Unterstützte Formate:\\n• Name,ID\\n• Name ID\\n• Zwei Zeilen: Name\\n  nächste Zeile: ID\\n\\nBeispiel:\\nAlice\\nalice_id\\n\\nBob, bob_id"},null,512),[[S,R.value]]),t("div",{class:"row"},[t("button",{onClick:J},"Importieren"),t("button",{onClick:H},"Leeren")]),n[10]||(n[10]=t("h3",{style:{"margin-top":"16px"}},"OCR (Screenshots)",-1)),t("div",Se,[t("input",{type:"file",accept:"image/*",multiple:"",onChange:G},null,32),t("button",{disabled:v.value||x.value.length===0,onClick:Z},"OCR starten",8,Ce),v.value?(p(),d("span",Ee,"…erkenne Text…")):O("",!0)]),t("div",{class:"row",style:{"margin-top":"12px"}},[t("button",{onClick:K},"Speichern"),t("button",{onClick:q},"Laden"),t("button",{onClick:Q},"Alles löschen"),t("button",{class:"apply",onClick:ee},"Auf App anwenden")]),n[11]||(n[11]=t("h3",{style:{"margin-top":"16px"}},"Export/Import JSON",-1)),t("div",Re,[t("button",{onClick:W},"Als roster.json herunterladen"),t("input",{type:"file",accept:"application/json",onChange:X},null,32)]),T.value?(p(),d("div",xe,[I(t("input",{"onUpdate:modelValue":n[4]||(n[4]=s=>N.value=s),placeholder:"Admin-Token (vom Server)"},null,512),[[S,N.value]]),t("button",{disabled:v.value,onClick:U},"Server laden",8,Te),t("button",{disabled:v.value||!N.value,onClick:Y},"Server speichern",8,Ne),f.value?(p(),d("small",Be,j(f.value),1)):O("",!0)])):O("",!0)])])])):(p(),d("div",de,[n[5]||(n[5]=t("h2",null,"Admin PIN",-1)),t("div",pe,[I(t("input",{"onUpdate:modelValue":n[0]||(n[0]=s=>r.value=s),type:"password",placeholder:"PIN",onKeyup:ne($,["enter"])},null,544),[[S,r.value]]),t("button",{onClick:$},"Öffnen")]),n[6]||(n[6]=t("small",{class:"muted"},'Setze VITE_ADMIN_PIN in .env.local (Standard: "admin").',-1))]))]))}}),Pe=ie(Le,[["__scopeId","data-v-e5537e8e"]]);export{Pe as default};
