const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-BqeNKh0y.js","assets/_commonjsHelpers-BosuxZz1.js"])))=>i.map(i=>d[i]);
import{d as ke,r,c as n,C as s,k as w,j as C,D as S,E as Ce,K as _e,H as v,F as H,u as K,L as Se,_ as Ae,b as l}from"./index-BKMB64Cr.js";import{g as A,c as W,s as z,b as xe,a as Ie,i as Re,_ as Ee}from"./shoutoutService-M-qWEmfQ.js";const E={};function G(){const d=E==null?void 0:E.VITE_API_BASE;return d&&d.trim().length?d.trim().replace(/\/$/,""):null}function Ne(){const d=String((E==null?void 0:E.VITE_REMOTE_ROSTER)??"").trim();return!!G()||d==="1"||/^true$/i.test(d)}async function Le(){const d=G();if(!d)throw new Error("VITE_API_BASE not set");const m=await fetch(`${d}/api/roster`,{method:"GET",headers:{Accept:"application/json"}});if(!m.ok)throw new Error(`fetch roster failed: ${m.status}`);const p=await m.json();return(Array.isArray(p==null?void 0:p.roster)?p.roster:[]).filter(f=>f&&typeof f.name=="string"&&typeof f.id=="string")}async function De(d,m){const p=G();if(!p)throw new Error("VITE_API_BASE not set");const i=await fetch(`${p}/api/roster`,{method:"PUT",headers:{"Content-Type":"application/json",Accept:"application/json","x-admin-token":m||""},body:JSON.stringify({roster:d})});if(!i.ok){const f=await i.text().catch(()=>"");throw new Error(`save roster failed: ${i.status} ${f}`)}}const je={class:"admin"},Te={key:0,class:"gate"},Oe={class:"row"},ze={key:1,class:"section"},Fe={class:"grid"},Ve={class:"panel"},Pe={class:"list"},$e={key:0,class:"empty"},Be={class:"meta"},Ue=["title"],Je=["title"],Me=["onClick"],He={key:1,class:"fixed",title:"Always present"},Ke={class:"panel"},We={class:"row"},Ge={class:"row"},qe=["disabled"],Qe={key:0},Ze={class:"row"},Xe={key:0,class:"row",style:{"margin-top":"12px"}},Ye=["disabled"],et=["disabled"],tt={key:0,class:"muted"},st={key:2,class:"section"},ot={class:"panel"},at={class:"firebase-status"},nt={key:0,class:"status-badge status-online"},lt={key:1,class:"status-badge status-offline"},it={class:"muted"},rt={key:0},ut={class:"shoutout-display"},ct={class:"shoutout-info"},dt={class:"date"},vt={class:"search-section"},pt={class:"row"},mt={key:0,class:"search-results"},ft=["onClick"],ht={key:1,class:"selected-section"},yt={class:"row"},gt=["value"],wt={class:"row"},bt={class:"row"},kt={key:0,class:"json-output"},Ct=["value"],_t=ke({__name:"Admin",setup(d){const m=r(sessionStorage.getItem("ti.admin.ok")==="1"),p=r(""),i=r(A().filter(t=>t.id.toLowerCase()!=="crepewithmarzipan")),f=r(""),F=r(""),V=r(""),P=r([]),h=r(!1);let N=null;const $=r(Ne()),B=r(""),g=r(""),_=r(null),L=r(""),D=r(""),x=r([]),y=r(null),I=r(""),j=r(""),U=r(""),T=r(Re()),q=["for their positive energy today!","for the amazing feedback!","for the loyal community support!","for the creative ideas!","for the motivating behavior!","for the helpful collaboration!","for the great contribution to the community!","for the inspiring presence!","for the engagement and enthusiasm!","for the friendly nature!"];function Q(){if(p.value===String("2410"))m.value=!0,sessionStorage.setItem("ti.admin.ok","1"),$.value&&Y();else try{window.alert("Wrong PIN")}catch{}}function O(t){return t.replace(/^@+/,"").trim()}function se(){const t=f.value.trim(),e=O(F.value);!t||!e||e.toLowerCase()!=="crepewithmarzipan"&&(W([{name:t,id:e}]),i.value=A().filter(o=>o.id.toLowerCase()!=="crepewithmarzipan"),f.value="",F.value="")}function Z(t){const o=t.split(/\r?\n/).map(u=>u.trim()).filter(u=>u.length>0),a=[],c=u=>/^[A-Za-z0-9._-]+$/.test(u);for(let u=0;u<o.length;u++){const R=o[u];if(R.includes(",")){const b=R.split(",");if(b.length===2){const k=String(b[0]??"").trim(),M=String(b[1]??"").trim(),te=O(M);if(k&&c(te)){a.push({name:k,id:te});continue}}}if(u+1<o.length){const b=o[u+1],k=O(b);if(c(k)){a.push({name:R,id:k}),u++;continue}}const J=R.split(/[\t ]+/);if(J.length>=2){const b=O(J[J.length-1]||"");if(c(b)){const k=J.slice(0,-1).join(" ").trim(),M=b;if(k&&M){a.push({name:k,id:M});continue}}}a.push({name:R,id:O(R)})}return a}function oe(){const t=Z(V.value);if(!t.length)return;const e=t.filter(o=>o.id.toLowerCase()!=="crepewithmarzipan");W(e),i.value=A().filter(o=>o.id.toLowerCase()!=="crepewithmarzipan")}function ae(){V.value=""}function ne(t){const e=t.target;P.value=Array.from(e.files||[])}async function le(){if(P.value.length){if(!N)try{N=await Ae(()=>import("./index-BqeNKh0y.js").then(t=>t.i),__vite__mapDeps([0,1]))}catch{N=null}if(N){h.value=!0;try{const t=[];for(const c of P.value){const{data:u}=await N.recognize(c,"eng");t.push((u==null?void 0:u.text)||"")}const o=t.join(`
`).replace(/[@#]/g,"").replace(/[^\p{L}\p{N} _.,\n\-]/gu," "),a=Z(o);W(a),i.value=A()}finally{h.value=!1}}}}function ie(t){i.value.splice(t,1),z([{name:"crepewithmarzipan",id:"crepewithmarzipan"},...i.value])}async function re(){z(i.value);try{await ue()}catch{}try{X()}catch{}}async function ue(){const t=window;if(!t.showSaveFilePicker)throw new Error("no-fs-api");const e={roster:i.value},o=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),c=await(await t.showSaveFilePicker({suggestedName:"roster.json",types:[{description:"JSON",accept:{"application/json":[".json"]}}]})).createWritable();await c.write(o),await c.close()}function ce(){i.value=A()}function de(){i.value=[],z([])}function X(){const t={roster:i.value},e=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),o=URL.createObjectURL(e),a=document.createElement("a");a.href=o,a.download="roster.json",document.body.appendChild(a),a.click(),setTimeout(()=>{URL.revokeObjectURL(o),document.body.removeChild(a)},0)}function ve(t){const e=t.target,o=e.files&&e.files[0];if(!o)return;const a=new FileReader;a.onload=()=>{try{const c=JSON.parse(String(a.result||"{}")),u=Array.isArray(c==null?void 0:c.roster)?c.roster:[];u.length&&(z(u),i.value=A())}catch{}},a.readAsText(o)}async function Y(){if($.value){h.value=!0,g.value="Loading server rosterâ€¦";try{const t=await Le();Array.isArray(t)&&t.length?(i.value=t,z(t),g.value=`Loaded (${t.length})`):g.value="Server roster empty"}catch(t){g.value=`Error: ${(t==null?void 0:t.message)||t}`}finally{h.value=!1}}}async function pe(){if($.value){h.value=!0,g.value="Saving to serverâ€¦";try{await De(i.value,B.value),g.value="Saved."}catch(t){g.value=`Error: ${(t==null?void 0:t.message)||t}`}finally{h.value=!1}}}function me(){const t=[{name:"crepewithmarzipan",id:"crepewithmarzipan"},...i.value],e=new CustomEvent("ti:applyRoster",{detail:{roster:t}});window.dispatchEvent(e)}async function fe(){if(T.value)try{const t=await xe();if(t){_.value=t.shoutout,L.value=t.date;return}}catch(t){console.log("Firebase error:",t)}try{const e=await fetch("/daily-shoutout.json",{cache:"no-cache"});if(e.ok){const o=await e.json();_.value=o.shoutout,L.value=o.date}}catch{const e=localStorage.getItem("dailyShoutout");if(e)try{const o=JSON.parse(e);_.value=o.shoutout,L.value=o.date}catch{}}}function he(){const t=D.value.toLowerCase().trim();if(!t){x.value=[];return}const e=A().filter(o=>o.id.toLowerCase()!=="crepewithmarzipan");x.value=e.filter(o=>o.name.toLowerCase().includes(t)||o.id.toLowerCase().includes(t)).slice(0,10)}function ye(t){y.value=t,I.value=q[0],D.value="",x.value=[]}function ee(){y.value=null,I.value="",j.value="",D.value="",x.value=[],U.value=""}function ge(){const t=(j.value||"").trim()||I.value;if(!y.value||!t)return;const o={date:new Date().toDateString(),shoutout:{name:y.value.name,reason:t,followerId:y.value.id}};U.value=JSON.stringify(o,null,2)}function we(t){const e=t.target;e.select(),e.setSelectionRange(0,99999)}async function be(){const t=(j.value||"").trim()||I.value;if(!y.value||!t)return;const e={name:y.value.name,reason:t,followerId:y.value.id},o=new Date().toDateString();await Ie({date:o,shoutout:e})?(_.value=e,L.value=o,alert(`ðŸ”¥ Live shout-out set for ${e.name}! All users will see it instantly.`)):alert("âŒ Failed to save to Firebase. Check your connection and config."),ee()}return m.value&&fe(),(t,e)=>(l(),n("div",je,[e[22]||(e[22]=s("h1",null,"Admin",-1)),m.value?(l(),n("section",ze,[e[16]||(e[16]=s("h2",null,"Roster",-1)),s("div",Fe,[s("div",Ve,[e[10]||(e[10]=_e('<h3 data-v-57e6a785>My profile (always present)</h3><div class="list" data-v-57e6a785><div class="item" data-v-57e6a785><div class="meta" data-v-57e6a785><strong class="name" data-v-57e6a785>crepewithmarzipan</strong><small class="id" data-v-57e6a785>crepewithmarzipan</small></div><span class="fixed" title="Always present" data-v-57e6a785>fixed</span></div></div><h3 style="margin-top:12px;" data-v-57e6a785>Others</h3>',3)),s("h3",null,"Current list ("+v(i.value.length)+")",1),s("div",Pe,[i.value.length?w("",!0):(l(),n("div",$e,"No entries yet. Add people above.")),(l(!0),n(H,null,K(i.value,(o,a)=>(l(),n("div",{key:o.id+":"+a,class:"item"},[s("div",Be,[s("strong",{class:"name",title:o.name},v(o.name),9,Ue),s("small",{class:"id",title:o.id},v(o.id),9,Je)]),o.id!=="crepewithmarzipan"?(l(),n("button",{key:0,class:"remove",onClick:c=>ie(a),title:"Remove"},"âœ•",8,Me)):(l(),n("span",He,"fixed"))]))),128))])]),s("div",Ke,[e[11]||(e[11]=s("h3",null,"Add",-1)),s("div",We,[C(s("input",{"onUpdate:modelValue":e[1]||(e[1]=o=>f.value=o),placeholder:"Name"},null,512),[[S,f.value]]),C(s("input",{"onUpdate:modelValue":e[2]||(e[2]=o=>F.value=o),placeholder:"ID/Handle"},null,512),[[S,F.value]]),s("button",{onClick:se},"Add")]),e[12]||(e[12]=s("small",{class:"muted"},"Duplicates are removed by ID.",-1)),e[13]||(e[13]=s("h3",{style:{"margin-top":"16px"}},"Bulk",-1)),C(s("textarea",{"onUpdate:modelValue":e[3]||(e[3]=o=>V.value=o),rows:"10",placeholder:"Supported formats:\\nâ€¢ Name,ID\\nâ€¢ Name ID\\nâ€¢ Two lines: Name\\n  next line: ID\\n\\nExample:\\nAlice\\nalice_id\\n\\nBob, bob_id"},null,512),[[S,V.value]]),s("div",{class:"row"},[s("button",{onClick:oe},"Import"),s("button",{onClick:ae},"Clear")]),e[14]||(e[14]=s("h3",{style:{"margin-top":"16px"}},"OCR (screenshots)",-1)),s("div",Ge,[s("input",{type:"file",accept:"image/*",multiple:"",onChange:ne},null,32),s("button",{disabled:h.value||P.value.length===0,onClick:le},"Run OCR",8,qe),h.value?(l(),n("span",Qe,"â€¦recognizingâ€¦")):w("",!0)]),s("div",{class:"row",style:{"margin-top":"12px"}},[s("button",{onClick:re},"Save"),s("button",{onClick:ce},"Load"),s("button",{onClick:de},"Clear all"),s("button",{class:"apply",onClick:me},"Apply to app")]),e[15]||(e[15]=s("h3",{style:{"margin-top":"16px"}},"Export/Import JSON",-1)),s("div",Ze,[s("button",{onClick:X},"Download roster.json"),s("input",{type:"file",accept:"application/json",onChange:ve},null,32)]),$.value?(l(),n("div",Xe,[C(s("input",{"onUpdate:modelValue":e[4]||(e[4]=o=>B.value=o),placeholder:"Admin token (from server)"},null,512),[[S,B.value]]),s("button",{disabled:h.value,onClick:Y},"Load server",8,Ye),s("button",{disabled:h.value||!B.value,onClick:pe},"Save server",8,et),g.value?(l(),n("small",tt,v(g.value),1)):w("",!0)])):w("",!0)])])])):(l(),n("div",Te,[e[8]||(e[8]=s("h2",null,"Admin PIN",-1)),s("div",Oe,[C(s("input",{"onUpdate:modelValue":e[0]||(e[0]=o=>p.value=o),type:"password",placeholder:"PIN",onKeyup:Ce(Q,["enter"])},null,544),[[S,p.value]]),s("button",{onClick:Q},"Open")]),e[9]||(e[9]=s("small",{class:"muted"},'Set VITE_ADMIN_PIN in .env.local (default: "admin").',-1))])),m.value?(l(),n("section",st,[e[21]||(e[21]=s("h2",null,"Daily Shout-out",-1)),s("div",ot,[s("div",at,[T.value?(l(),n("span",nt,"ðŸ”¥ Firebase Connected")):(l(),n("span",lt,"âš ï¸ Firebase Not Configured")),s("small",it,v(T.value?"Changes sync to all users instantly":"Using local fallback - add Firebase config for real-time sync"),1)]),_.value?(l(),n("div",rt,[e[17]||(e[17]=s("h3",null,"Current Daily Shout-out",-1)),s("div",ut,[s("div",ct,[s("strong",null,v(_.value.name),1),s("small",null,v(_.value.reason),1),s("small",dt,v(L.value),1)])])])):w("",!0),e[20]||(e[20]=s("h3",{style:{"margin-top":"16px"}},"Set New Shout-out",-1)),s("div",vt,[s("div",pt,[C(s("input",{"onUpdate:modelValue":e[5]||(e[5]=o=>D.value=o),placeholder:"Search follower by name...",onInput:he},null,544),[[S,D.value]])]),x.value.length?(l(),n("div",mt,[(l(!0),n(H,null,K(x.value,o=>(l(),n("div",{key:o.id,class:"search-item",onClick:a=>ye(o)},[s("strong",null,v(o.name),1),s("small",null,v(o.id),1)],8,ft))),128))])):w("",!0)]),y.value?(l(),n("div",ht,[s("h4",null,"Selected: "+v(y.value.name),1),s("div",yt,[C(s("select",{"onUpdate:modelValue":e[6]||(e[6]=o=>I.value=o)},[(l(),n(H,null,K(q,o=>s("option",{key:o,value:o},v(o),9,gt)),64))],512),[[Se,I.value]])]),s("div",wt,[C(s("input",{"onUpdate:modelValue":e[7]||(e[7]=o=>j.value=o),placeholder:"Personal reason (optional) â€“ will override the dropdown if filled"},null,512),[[S,j.value]])]),s("div",bt,[T.value?(l(),n("button",{key:0,onClick:be,class:"apply"},"Set Live Shout-out")):(l(),n("button",{key:1,onClick:ge,class:"apply"},"Generate JSON Code")),s("button",{onClick:ee},"Cancel")]),U.value&&!T.value?(l(),n("div",kt,[e[18]||(e[18]=s("h4",null,"Copy this to public/daily-shoutout.json:",-1)),s("textarea",{readonly:"",value:U.value,onClick:we,class:"json-code"},null,8,Ct),e[19]||(e[19]=s("small",{class:"muted"},"Click textarea to select all, then Ctrl+C to copy",-1))])):w("",!0)])):w("",!0)])])):w("",!0)]))}}),xt=Ee(_t,[["__scopeId","data-v-57e6a785"]]);export{xt as default};
