const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-BqeNKh0y.js","assets/_commonjsHelpers-BosuxZz1.js"])))=>i.map(i=>d[i]);
import{d as be,r as u,c as n,C as s,k as w,j as S,D as R,E as ke,K as Ce,H as v,F as M,u as H,L as _e,_ as Se,b as l}from"./index-njCq2U_V.js";import{g as A,c as K,s as O,b as Ae,a as xe,i as Ie,_ as Re}from"./shoutoutService-M-qWEmfQ.js";const E={};function W(){const d=E==null?void 0:E.VITE_API_BASE;return d&&d.trim().length?d.trim().replace(/\/$/,""):null}function Ee(){const d=String((E==null?void 0:E.VITE_REMOTE_ROSTER)??"").trim();return!!W()||d==="1"||/^true$/i.test(d)}async function Ne(){const d=W();if(!d)throw new Error("VITE_API_BASE not set");const m=await fetch(`${d}/api/roster`,{method:"GET",headers:{Accept:"application/json"}});if(!m.ok)throw new Error(`fetch roster failed: ${m.status}`);const p=await m.json();return(Array.isArray(p==null?void 0:p.roster)?p.roster:[]).filter(h=>h&&typeof h.name=="string"&&typeof h.id=="string")}async function Le(d,m){const p=W();if(!p)throw new Error("VITE_API_BASE not set");const i=await fetch(`${p}/api/roster`,{method:"PUT",headers:{"Content-Type":"application/json",Accept:"application/json","x-admin-token":m||""},body:JSON.stringify({roster:d})});if(!i.ok){const h=await i.text().catch(()=>"");throw new Error(`save roster failed: ${i.status} ${h}`)}}const De={class:"admin"},je={key:0,class:"gate"},Te={class:"row"},Oe={key:1,class:"section"},ze={class:"grid"},Fe={class:"panel"},Ve={class:"list"},Pe={key:0,class:"empty"},$e={class:"meta"},Be=["title"],Je=["title"],Ue=["onClick"],Me={key:1,class:"fixed",title:"Always present"},He={class:"panel"},Ke={class:"row"},We={class:"row"},Ge=["disabled"],qe={key:0},Qe={class:"row"},Ze={key:0,class:"row",style:{"margin-top":"12px"}},Xe=["disabled"],Ye=["disabled"],et={key:0,class:"muted"},tt={key:2,class:"section"},st={class:"panel"},ot={class:"firebase-status"},at={key:0,class:"status-badge status-online"},nt={key:1,class:"status-badge status-offline"},lt={class:"muted"},it={key:0},rt={class:"shoutout-display"},ut={class:"shoutout-info"},ct={class:"date"},dt={class:"search-section"},vt={class:"row"},pt={key:0,class:"search-results"},mt=["onClick"],ht={key:1,class:"selected-section"},ft={class:"row"},yt=["value"],gt={class:"row"},wt={key:0,class:"json-output"},bt=["value"],kt=be({__name:"Admin",setup(d){const m=u(sessionStorage.getItem("ti.admin.ok")==="1"),p=u(""),i=u(A().filter(t=>t.id.toLowerCase()!=="crepewithmarzipan")),h=u(""),z=u(""),F=u(""),V=u([]),f=u(!1);let N=null;const P=u(Ee()),$=u(""),g=u(""),_=u(null),L=u(""),D=u(""),x=u([]),y=u(null),b=u(""),B=u(""),j=u(Ie()),G=["for their positive energy today!","for the amazing feedback!","for the loyal community support!","for the creative ideas!","for the motivating behavior!","for the helpful collaboration!","for the great contribution to the community!","for the inspiring presence!","for the engagement and enthusiasm!","for the friendly nature!"];function q(){if(p.value===String("2410"))m.value=!0,sessionStorage.setItem("ti.admin.ok","1"),P.value&&X();else try{window.alert("Wrong PIN")}catch{}}function T(t){return t.replace(/^@+/,"").trim()}function te(){const t=h.value.trim(),e=T(z.value);!t||!e||e.toLowerCase()!=="crepewithmarzipan"&&(K([{name:t,id:e}]),i.value=A().filter(o=>o.id.toLowerCase()!=="crepewithmarzipan"),h.value="",z.value="")}function Q(t){const o=t.split(/\r?\n/).map(r=>r.trim()).filter(r=>r.length>0),a=[],c=r=>/^[A-Za-z0-9._-]+$/.test(r);for(let r=0;r<o.length;r++){const I=o[r];if(I.includes(",")){const k=I.split(",");if(k.length===2){const C=String(k[0]??"").trim(),U=String(k[1]??"").trim(),ee=T(U);if(C&&c(ee)){a.push({name:C,id:ee});continue}}}if(r+1<o.length){const k=o[r+1],C=T(k);if(c(C)){a.push({name:I,id:C}),r++;continue}}const J=I.split(/[\t ]+/);if(J.length>=2){const k=T(J[J.length-1]||"");if(c(k)){const C=J.slice(0,-1).join(" ").trim(),U=k;if(C&&U){a.push({name:C,id:U});continue}}}a.push({name:I,id:T(I)})}return a}function se(){const t=Q(F.value);if(!t.length)return;const e=t.filter(o=>o.id.toLowerCase()!=="crepewithmarzipan");K(e),i.value=A().filter(o=>o.id.toLowerCase()!=="crepewithmarzipan")}function oe(){F.value=""}function ae(t){const e=t.target;V.value=Array.from(e.files||[])}async function ne(){if(V.value.length){if(!N)try{N=await Se(()=>import("./index-BqeNKh0y.js").then(t=>t.i),__vite__mapDeps([0,1]))}catch{N=null}if(N){f.value=!0;try{const t=[];for(const c of V.value){const{data:r}=await N.recognize(c,"eng");t.push((r==null?void 0:r.text)||"")}const o=t.join(`
`).replace(/[@#]/g,"").replace(/[^\p{L}\p{N} _.,\n\-]/gu," "),a=Q(o);K(a),i.value=A()}finally{f.value=!1}}}}function le(t){i.value.splice(t,1),O([{name:"crepewithmarzipan",id:"crepewithmarzipan"},...i.value])}async function ie(){O(i.value);try{await re()}catch{}try{Z()}catch{}}async function re(){const t=window;if(!t.showSaveFilePicker)throw new Error("no-fs-api");const e={roster:i.value},o=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),c=await(await t.showSaveFilePicker({suggestedName:"roster.json",types:[{description:"JSON",accept:{"application/json":[".json"]}}]})).createWritable();await c.write(o),await c.close()}function ue(){i.value=A()}function ce(){i.value=[],O([])}function Z(){const t={roster:i.value},e=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),o=URL.createObjectURL(e),a=document.createElement("a");a.href=o,a.download="roster.json",document.body.appendChild(a),a.click(),setTimeout(()=>{URL.revokeObjectURL(o),document.body.removeChild(a)},0)}function de(t){const e=t.target,o=e.files&&e.files[0];if(!o)return;const a=new FileReader;a.onload=()=>{try{const c=JSON.parse(String(a.result||"{}")),r=Array.isArray(c==null?void 0:c.roster)?c.roster:[];r.length&&(O(r),i.value=A())}catch{}},a.readAsText(o)}async function X(){if(P.value){f.value=!0,g.value="Loading server roster…";try{const t=await Ne();Array.isArray(t)&&t.length?(i.value=t,O(t),g.value=`Loaded (${t.length})`):g.value="Server roster empty"}catch(t){g.value=`Error: ${(t==null?void 0:t.message)||t}`}finally{f.value=!1}}}async function ve(){if(P.value){f.value=!0,g.value="Saving to server…";try{await Le(i.value,$.value),g.value="Saved."}catch(t){g.value=`Error: ${(t==null?void 0:t.message)||t}`}finally{f.value=!1}}}function pe(){const t=[{name:"crepewithmarzipan",id:"crepewithmarzipan"},...i.value],e=new CustomEvent("ti:applyRoster",{detail:{roster:t}});window.dispatchEvent(e)}async function me(){if(j.value)try{const t=await Ae();if(t){_.value=t.shoutout,L.value=t.date;return}}catch(t){console.log("Firebase error:",t)}try{const e=await fetch("/daily-shoutout.json",{cache:"no-cache"});if(e.ok){const o=await e.json();_.value=o.shoutout,L.value=o.date}}catch{const e=localStorage.getItem("dailyShoutout");if(e)try{const o=JSON.parse(e);_.value=o.shoutout,L.value=o.date}catch{}}}function he(){const t=D.value.toLowerCase().trim();if(!t){x.value=[];return}const e=A().filter(o=>o.id.toLowerCase()!=="crepewithmarzipan");x.value=e.filter(o=>o.name.toLowerCase().includes(t)||o.id.toLowerCase().includes(t)).slice(0,10)}function fe(t){y.value=t,b.value=G[0],D.value="",x.value=[]}function Y(){y.value=null,b.value="",D.value="",x.value=[],B.value=""}function ye(){if(!y.value||!b.value)return;const e={date:new Date().toDateString(),shoutout:{name:y.value.name,reason:b.value,followerId:y.value.id}};B.value=JSON.stringify(e,null,2)}function ge(t){const e=t.target;e.select(),e.setSelectionRange(0,99999)}async function we(){if(!y.value||!b.value)return;const t={name:y.value.name,reason:b.value,followerId:y.value.id},e=new Date().toDateString();await xe({date:e,shoutout:t})?(_.value=t,L.value=e,alert(`🔥 Live shout-out set for ${t.name}! All users will see it instantly.`)):alert("❌ Failed to save to Firebase. Check your connection and config."),Y()}return m.value&&me(),(t,e)=>(l(),n("div",De,[e[21]||(e[21]=s("h1",null,"Admin",-1)),m.value?(l(),n("section",Oe,[e[15]||(e[15]=s("h2",null,"Roster",-1)),s("div",ze,[s("div",Fe,[e[9]||(e[9]=Ce('<h3 data-v-b6d042ae>My profile (always present)</h3><div class="list" data-v-b6d042ae><div class="item" data-v-b6d042ae><div class="meta" data-v-b6d042ae><strong class="name" data-v-b6d042ae>crepewithmarzipan</strong><small class="id" data-v-b6d042ae>crepewithmarzipan</small></div><span class="fixed" title="Always present" data-v-b6d042ae>fixed</span></div></div><h3 style="margin-top:12px;" data-v-b6d042ae>Others</h3>',3)),s("h3",null,"Current list ("+v(i.value.length)+")",1),s("div",Ve,[i.value.length?w("",!0):(l(),n("div",Pe,"No entries yet. Add people above.")),(l(!0),n(M,null,H(i.value,(o,a)=>(l(),n("div",{key:o.id+":"+a,class:"item"},[s("div",$e,[s("strong",{class:"name",title:o.name},v(o.name),9,Be),s("small",{class:"id",title:o.id},v(o.id),9,Je)]),o.id!=="crepewithmarzipan"?(l(),n("button",{key:0,class:"remove",onClick:c=>le(a),title:"Remove"},"✕",8,Ue)):(l(),n("span",Me,"fixed"))]))),128))])]),s("div",He,[e[10]||(e[10]=s("h3",null,"Add",-1)),s("div",Ke,[S(s("input",{"onUpdate:modelValue":e[1]||(e[1]=o=>h.value=o),placeholder:"Name"},null,512),[[R,h.value]]),S(s("input",{"onUpdate:modelValue":e[2]||(e[2]=o=>z.value=o),placeholder:"ID/Handle"},null,512),[[R,z.value]]),s("button",{onClick:te},"Add")]),e[11]||(e[11]=s("small",{class:"muted"},"Duplicates are removed by ID.",-1)),e[12]||(e[12]=s("h3",{style:{"margin-top":"16px"}},"Bulk",-1)),S(s("textarea",{"onUpdate:modelValue":e[3]||(e[3]=o=>F.value=o),rows:"10",placeholder:"Supported formats:\\n• Name,ID\\n• Name ID\\n• Two lines: Name\\n  next line: ID\\n\\nExample:\\nAlice\\nalice_id\\n\\nBob, bob_id"},null,512),[[R,F.value]]),s("div",{class:"row"},[s("button",{onClick:se},"Import"),s("button",{onClick:oe},"Clear")]),e[13]||(e[13]=s("h3",{style:{"margin-top":"16px"}},"OCR (screenshots)",-1)),s("div",We,[s("input",{type:"file",accept:"image/*",multiple:"",onChange:ae},null,32),s("button",{disabled:f.value||V.value.length===0,onClick:ne},"Run OCR",8,Ge),f.value?(l(),n("span",qe,"…recognizing…")):w("",!0)]),s("div",{class:"row",style:{"margin-top":"12px"}},[s("button",{onClick:ie},"Save"),s("button",{onClick:ue},"Load"),s("button",{onClick:ce},"Clear all"),s("button",{class:"apply",onClick:pe},"Apply to app")]),e[14]||(e[14]=s("h3",{style:{"margin-top":"16px"}},"Export/Import JSON",-1)),s("div",Qe,[s("button",{onClick:Z},"Download roster.json"),s("input",{type:"file",accept:"application/json",onChange:de},null,32)]),P.value?(l(),n("div",Ze,[S(s("input",{"onUpdate:modelValue":e[4]||(e[4]=o=>$.value=o),placeholder:"Admin token (from server)"},null,512),[[R,$.value]]),s("button",{disabled:f.value,onClick:X},"Load server",8,Xe),s("button",{disabled:f.value||!$.value,onClick:ve},"Save server",8,Ye),g.value?(l(),n("small",et,v(g.value),1)):w("",!0)])):w("",!0)])])])):(l(),n("div",je,[e[7]||(e[7]=s("h2",null,"Admin PIN",-1)),s("div",Te,[S(s("input",{"onUpdate:modelValue":e[0]||(e[0]=o=>p.value=o),type:"password",placeholder:"PIN",onKeyup:ke(q,["enter"])},null,544),[[R,p.value]]),s("button",{onClick:q},"Open")]),e[8]||(e[8]=s("small",{class:"muted"},'Set VITE_ADMIN_PIN in .env.local (default: "admin").',-1))])),m.value?(l(),n("section",tt,[e[20]||(e[20]=s("h2",null,"Daily Shout-out",-1)),s("div",st,[s("div",ot,[j.value?(l(),n("span",at,"🔥 Firebase Connected")):(l(),n("span",nt,"⚠️ Firebase Not Configured")),s("small",lt,v(j.value?"Changes sync to all users instantly":"Using local fallback - add Firebase config for real-time sync"),1)]),_.value?(l(),n("div",it,[e[16]||(e[16]=s("h3",null,"Current Daily Shout-out",-1)),s("div",rt,[s("div",ut,[s("strong",null,v(_.value.name),1),s("small",null,v(_.value.reason),1),s("small",ct,v(L.value),1)])])])):w("",!0),e[19]||(e[19]=s("h3",{style:{"margin-top":"16px"}},"Set New Shout-out",-1)),s("div",dt,[s("div",vt,[S(s("input",{"onUpdate:modelValue":e[5]||(e[5]=o=>D.value=o),placeholder:"Search follower by name...",onInput:he},null,544),[[R,D.value]])]),x.value.length?(l(),n("div",pt,[(l(!0),n(M,null,H(x.value,o=>(l(),n("div",{key:o.id,class:"search-item",onClick:a=>fe(o)},[s("strong",null,v(o.name),1),s("small",null,v(o.id),1)],8,mt))),128))])):w("",!0)]),y.value?(l(),n("div",ht,[s("h4",null,"Selected: "+v(y.value.name),1),s("div",ft,[S(s("select",{"onUpdate:modelValue":e[6]||(e[6]=o=>b.value=o)},[(l(),n(M,null,H(G,o=>s("option",{key:o,value:o},v(o),9,yt)),64))],512),[[_e,b.value]])]),s("div",gt,[j.value?(l(),n("button",{key:0,onClick:we,class:"apply"},"Set Live Shout-out")):(l(),n("button",{key:1,onClick:ye,class:"apply"},"Generate JSON Code")),s("button",{onClick:Y},"Cancel")]),B.value&&!j.value?(l(),n("div",wt,[e[17]||(e[17]=s("h4",null,"Copy this to public/daily-shoutout.json:",-1)),s("textarea",{readonly:"",value:B.value,onClick:ge,class:"json-code"},null,8,bt),e[18]||(e[18]=s("small",{class:"muted"},"Click textarea to select all, then Ctrl+C to copy",-1))])):w("",!0)])):w("",!0)])])):w("",!0)]))}}),St=Re(kt,[["__scopeId","data-v-b6d042ae"]]);export{St as default};
