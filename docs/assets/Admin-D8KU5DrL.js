const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-BqeNKh0y.js","assets/_commonjsHelpers-BosuxZz1.js"])))=>i.map(i=>d[i]);
import{d as he,r as u,c as i,C as n,k,j as S,D as E,E as ye,I as we,H as v,F as J,u as F,J as ge,_ as ke,b as r}from"./index-ts3CavvB.js";import{g as C,a as M,s as D,_ as be}from"./persistence-D321RUhn.js";const R={};function H(){const d=R==null?void 0:R.VITE_API_BASE;return d&&d.trim().length?d.trim().replace(/\/$/,""):null}function Se(){const d=String((R==null?void 0:R.VITE_REMOTE_ROSTER)??"").trim();return!!H()||d==="1"||/^true$/i.test(d)}async function Ce(){const d=H();if(!d)throw new Error("VITE_API_BASE not set");const m=await fetch(`${d}/api/roster`,{method:"GET",headers:{Accept:"application/json"}});if(!m.ok)throw new Error(`fetch roster failed: ${m.status}`);const p=await m.json();return(Array.isArray(p==null?void 0:p.roster)?p.roster:[]).filter(f=>f&&typeof f.name=="string"&&typeof f.id=="string")}async function _e(d,m){const p=H();if(!p)throw new Error("VITE_API_BASE not set");const s=await fetch(`${p}/api/roster`,{method:"PUT",headers:{"Content-Type":"application/json",Accept:"application/json","x-admin-token":m||""},body:JSON.stringify({roster:d})});if(!s.ok){const f=await s.text().catch(()=>"");throw new Error(`save roster failed: ${s.status} ${f}`)}}const Ae={class:"admin"},Ie={key:0,class:"gate"},xe={class:"row"},Ee={key:1,class:"section"},Re={class:"grid"},Ne={class:"panel"},Le={class:"list"},Te={key:0,class:"empty"},De={class:"meta"},je=["title"],Oe=["title"],ze=["onClick"],Ve={key:1,class:"fixed",title:"Always present"},Pe={class:"panel"},$e={class:"row"},Be={class:"row"},Ue=["disabled"],Je={key:0},Fe={class:"row"},Me={key:0,class:"row",style:{"margin-top":"12px"}},He=["disabled"],We=["disabled"],Ke={key:0,class:"muted"},qe={key:2,class:"section"},Ge={class:"panel"},Qe={key:0},Ze={class:"shoutout-display"},Xe={class:"shoutout-info"},Ye={class:"date"},et={class:"search-section"},tt={class:"row"},nt={key:0,class:"search-results"},ot=["onClick"],st={key:1,class:"selected-section"},at={class:"row"},lt=["value"],it=he({__name:"Admin",setup(d){const m=u(sessionStorage.getItem("ti.admin.ok")==="1"),p=u(""),s=u(C().filter(o=>o.id.toLowerCase()!=="crepewithmarzipan")),f=u(""),j=u(""),O=u(""),z=u([]),h=u(!1);let N=null;const V=u(Se()),P=u(""),y=u(""),_=u(null),$=u(""),L=u(""),A=u([]),b=u(null),I=u(""),W=["for their positive energy today!","for the amazing feedback!","for the loyal community support!","for the creative ideas!","for the motivating behavior!","for the helpful collaboration!","for the great contribution to the community!","for the inspiring presence!","for the engagement and enthusiasm!","for the friendly nature!"];function K(){if(p.value===String("2410"))m.value=!0,sessionStorage.setItem("ti.admin.ok","1"),V.value&&Q();else try{window.alert("Wrong PIN")}catch{}}function T(o){return o.replace(/^@+/,"").trim()}function Y(){const o=f.value.trim(),e=T(j.value);!o||!e||e.toLowerCase()!=="crepewithmarzipan"&&(M([{name:o,id:e}]),s.value=C().filter(t=>t.id.toLowerCase()!=="crepewithmarzipan"),f.value="",j.value="")}function q(o){const t=o.split(/\r?\n/).map(l=>l.trim()).filter(l=>l.length>0),a=[],c=l=>/^[A-Za-z0-9._-]+$/.test(l);for(let l=0;l<t.length;l++){const x=t[l];if(x.includes(",")){const w=x.split(",");if(w.length===2){const g=String(w[0]??"").trim(),U=String(w[1]??"").trim(),X=T(U);if(g&&c(X)){a.push({name:g,id:X});continue}}}if(l+1<t.length){const w=t[l+1],g=T(w);if(c(g)){a.push({name:x,id:g}),l++;continue}}const B=x.split(/[\t ]+/);if(B.length>=2){const w=T(B[B.length-1]||"");if(c(w)){const g=B.slice(0,-1).join(" ").trim(),U=w;if(g&&U){a.push({name:g,id:U});continue}}}a.push({name:x,id:T(x)})}return a}function ee(){const o=q(O.value);if(!o.length)return;const e=o.filter(t=>t.id.toLowerCase()!=="crepewithmarzipan");M(e),s.value=C().filter(t=>t.id.toLowerCase()!=="crepewithmarzipan")}function te(){O.value=""}function ne(o){const e=o.target;z.value=Array.from(e.files||[])}async function oe(){if(z.value.length){if(!N)try{N=await ke(()=>import("./index-BqeNKh0y.js").then(o=>o.i),__vite__mapDeps([0,1]))}catch{N=null}if(N){h.value=!0;try{const o=[];for(const c of z.value){const{data:l}=await N.recognize(c,"eng");o.push((l==null?void 0:l.text)||"")}const t=o.join(`
`).replace(/[@#]/g,"").replace(/[^\p{L}\p{N} _.,\n\-]/gu," "),a=q(t);M(a),s.value=C()}finally{h.value=!1}}}}function se(o){s.value.splice(o,1),D([{name:"crepewithmarzipan",id:"crepewithmarzipan"},...s.value])}async function ae(){D(s.value);try{await le()}catch{}try{G()}catch{}}async function le(){const o=window;if(!o.showSaveFilePicker)throw new Error("no-fs-api");const e={roster:s.value},t=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),c=await(await o.showSaveFilePicker({suggestedName:"roster.json",types:[{description:"JSON",accept:{"application/json":[".json"]}}]})).createWritable();await c.write(t),await c.close()}function ie(){s.value=C()}function re(){s.value=[],D([])}function G(){const o={roster:s.value},e=new Blob([JSON.stringify(o,null,2)],{type:"application/json"}),t=URL.createObjectURL(e),a=document.createElement("a");a.href=t,a.download="roster.json",document.body.appendChild(a),a.click(),setTimeout(()=>{URL.revokeObjectURL(t),document.body.removeChild(a)},0)}function ue(o){const e=o.target,t=e.files&&e.files[0];if(!t)return;const a=new FileReader;a.onload=()=>{try{const c=JSON.parse(String(a.result||"{}")),l=Array.isArray(c==null?void 0:c.roster)?c.roster:[];l.length&&(D(l),s.value=C())}catch{}},a.readAsText(t)}async function Q(){if(V.value){h.value=!0,y.value="Loading server roster…";try{const o=await Ce();Array.isArray(o)&&o.length?(s.value=o,D(o),y.value=`Loaded (${o.length})`):y.value="Server roster empty"}catch(o){y.value=`Error: ${(o==null?void 0:o.message)||o}`}finally{h.value=!1}}}async function ce(){if(V.value){h.value=!0,y.value="Saving to server…";try{await _e(s.value,P.value),y.value="Saved."}catch(o){y.value=`Error: ${(o==null?void 0:o.message)||o}`}finally{h.value=!1}}}function de(){const o=[{name:"crepewithmarzipan",id:"crepewithmarzipan"},...s.value],e=new CustomEvent("ti:applyRoster",{detail:{roster:o}});window.dispatchEvent(e)}async function pe(){try{const e=await fetch("/daily-shoutout.json",{cache:"no-cache"});if(e.ok){const t=await e.json();_.value=t.shoutout,$.value=t.date}}catch{const e=localStorage.getItem("dailyShoutout");if(e)try{const t=JSON.parse(e);_.value=t.shoutout,$.value=t.date}catch{}}}function ve(){const o=L.value.toLowerCase().trim();if(!o){A.value=[];return}const e=C().filter(t=>t.id.toLowerCase()!=="crepewithmarzipan");A.value=e.filter(t=>t.name.toLowerCase().includes(o)||t.id.toLowerCase().includes(o)).slice(0,10)}function me(o){b.value=o,I.value=W[0],L.value="",A.value=[]}function Z(){b.value=null,I.value="",L.value="",A.value=[]}async function fe(){if(!b.value||!I.value)return;const o={name:b.value.name,reason:I.value,followerId:b.value.id},e=new Date().toDateString(),t={shoutout:o,date:e};localStorage.setItem("dailyShoutout",JSON.stringify(t)),_.value=o,$.value=e,alert(`Daily shout-out set for ${o.name}!`),Z()}return m.value&&pe(),(o,e)=>(r(),i("div",Ae,[e[19]||(e[19]=n("h1",null,"Admin",-1)),m.value?(r(),i("section",Ee,[e[15]||(e[15]=n("h2",null,"Roster",-1)),n("div",Re,[n("div",Ne,[e[9]||(e[9]=we('<h3 data-v-c71df082>My profile (always present)</h3><div class="list" data-v-c71df082><div class="item" data-v-c71df082><div class="meta" data-v-c71df082><strong class="name" data-v-c71df082>crepewithmarzipan</strong><small class="id" data-v-c71df082>crepewithmarzipan</small></div><span class="fixed" title="Always present" data-v-c71df082>fixed</span></div></div><h3 style="margin-top:12px;" data-v-c71df082>Others</h3>',3)),n("h3",null,"Current list ("+v(s.value.length)+")",1),n("div",Le,[s.value.length?k("",!0):(r(),i("div",Te,"No entries yet. Add people above.")),(r(!0),i(J,null,F(s.value,(t,a)=>(r(),i("div",{key:t.id+":"+a,class:"item"},[n("div",De,[n("strong",{class:"name",title:t.name},v(t.name),9,je),n("small",{class:"id",title:t.id},v(t.id),9,Oe)]),t.id!=="crepewithmarzipan"?(r(),i("button",{key:0,class:"remove",onClick:c=>se(a),title:"Remove"},"✕",8,ze)):(r(),i("span",Ve,"fixed"))]))),128))])]),n("div",Pe,[e[10]||(e[10]=n("h3",null,"Add",-1)),n("div",$e,[S(n("input",{"onUpdate:modelValue":e[1]||(e[1]=t=>f.value=t),placeholder:"Name"},null,512),[[E,f.value]]),S(n("input",{"onUpdate:modelValue":e[2]||(e[2]=t=>j.value=t),placeholder:"ID/Handle"},null,512),[[E,j.value]]),n("button",{onClick:Y},"Add")]),e[11]||(e[11]=n("small",{class:"muted"},"Duplicates are removed by ID.",-1)),e[12]||(e[12]=n("h3",{style:{"margin-top":"16px"}},"Bulk",-1)),S(n("textarea",{"onUpdate:modelValue":e[3]||(e[3]=t=>O.value=t),rows:"10",placeholder:"Supported formats:\\n• Name,ID\\n• Name ID\\n• Two lines: Name\\n  next line: ID\\n\\nExample:\\nAlice\\nalice_id\\n\\nBob, bob_id"},null,512),[[E,O.value]]),n("div",{class:"row"},[n("button",{onClick:ee},"Import"),n("button",{onClick:te},"Clear")]),e[13]||(e[13]=n("h3",{style:{"margin-top":"16px"}},"OCR (screenshots)",-1)),n("div",Be,[n("input",{type:"file",accept:"image/*",multiple:"",onChange:ne},null,32),n("button",{disabled:h.value||z.value.length===0,onClick:oe},"Run OCR",8,Ue),h.value?(r(),i("span",Je,"…recognizing…")):k("",!0)]),n("div",{class:"row",style:{"margin-top":"12px"}},[n("button",{onClick:ae},"Save"),n("button",{onClick:ie},"Load"),n("button",{onClick:re},"Clear all"),n("button",{class:"apply",onClick:de},"Apply to app")]),e[14]||(e[14]=n("h3",{style:{"margin-top":"16px"}},"Export/Import JSON",-1)),n("div",Fe,[n("button",{onClick:G},"Download roster.json"),n("input",{type:"file",accept:"application/json",onChange:ue},null,32)]),V.value?(r(),i("div",Me,[S(n("input",{"onUpdate:modelValue":e[4]||(e[4]=t=>P.value=t),placeholder:"Admin token (from server)"},null,512),[[E,P.value]]),n("button",{disabled:h.value,onClick:Q},"Load server",8,He),n("button",{disabled:h.value||!P.value,onClick:ce},"Save server",8,We),y.value?(r(),i("small",Ke,v(y.value),1)):k("",!0)])):k("",!0)])])])):(r(),i("div",Ie,[e[7]||(e[7]=n("h2",null,"Admin PIN",-1)),n("div",xe,[S(n("input",{"onUpdate:modelValue":e[0]||(e[0]=t=>p.value=t),type:"password",placeholder:"PIN",onKeyup:ye(K,["enter"])},null,544),[[E,p.value]]),n("button",{onClick:K},"Open")]),e[8]||(e[8]=n("small",{class:"muted"},'Set VITE_ADMIN_PIN in .env.local (default: "admin").',-1))])),m.value?(r(),i("section",qe,[e[18]||(e[18]=n("h2",null,"Daily Shout-out",-1)),n("div",Ge,[_.value?(r(),i("div",Qe,[e[16]||(e[16]=n("h3",null,"Current Daily Shout-out",-1)),n("div",Ze,[n("div",Xe,[n("strong",null,v(_.value.name),1),n("small",null,v(_.value.reason),1),n("small",Ye,v($.value),1)])])])):k("",!0),e[17]||(e[17]=n("h3",{style:{"margin-top":"16px"}},"Set New Shout-out",-1)),n("div",et,[n("div",tt,[S(n("input",{"onUpdate:modelValue":e[5]||(e[5]=t=>L.value=t),placeholder:"Search follower by name...",onInput:ve},null,544),[[E,L.value]])]),A.value.length?(r(),i("div",nt,[(r(!0),i(J,null,F(A.value,t=>(r(),i("div",{key:t.id,class:"search-item",onClick:a=>me(t)},[n("strong",null,v(t.name),1),n("small",null,v(t.id),1)],8,ot))),128))])):k("",!0)]),b.value?(r(),i("div",st,[n("h4",null,"Selected: "+v(b.value.name),1),n("div",at,[S(n("select",{"onUpdate:modelValue":e[6]||(e[6]=t=>I.value=t)},[(r(),i(J,null,F(W,t=>n("option",{key:t,value:t},v(t),9,lt)),64))],512),[[ge,I.value]])]),n("div",{class:"row"},[n("button",{onClick:fe,class:"apply"},"Set as Daily Shout-out"),n("button",{onClick:Z},"Cancel")])])):k("",!0)])])):k("",!0)]))}}),ct=be(it,[["__scopeId","data-v-c71df082"]]);export{ct as default};
