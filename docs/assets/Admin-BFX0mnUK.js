const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-BqeNKh0y.js","assets/_commonjsHelpers-BosuxZz1.js"])))=>i.map(i=>d[i]);
import{d as we,r,c as n,C as o,k as w,j as C,D as S,E as be,I as ke,H as v,F as H,u as W,L as Ce,_ as _e,b as l}from"./index-BEYKUVpn.js";import{b as R,f as G,s as F,e as Se,c as xe,i as Ae,_ as Ie}from"./shoutoutService-BwCY42xT.js";const E={};function K(){const d=E==null?void 0:E.VITE_API_BASE;return d&&d.trim().length?d.trim().replace(/\/$/,""):null}function Re(){const d=String((E==null?void 0:E.VITE_REMOTE_ROSTER)??"").trim();return!!K()||d==="1"||/^true$/i.test(d)}async function Ee(){const d=K();if(!d)throw new Error("VITE_API_BASE not set");const m=await fetch(`${d}/api/roster`,{method:"GET",headers:{Accept:"application/json"}});if(!m.ok)throw new Error(`fetch roster failed: ${m.status}`);const p=await m.json();return(Array.isArray(p==null?void 0:p.roster)?p.roster:[]).filter(f=>f&&typeof f.name=="string"&&typeof f.id=="string")}async function Ne(d,m){const p=K();if(!p)throw new Error("VITE_API_BASE not set");const i=await fetch(`${p}/api/roster`,{method:"PUT",headers:{"Content-Type":"application/json",Accept:"application/json","x-admin-token":m||""},body:JSON.stringify({roster:d})});if(!i.ok){const f=await i.text().catch(()=>"");throw new Error(`save roster failed: ${i.status} ${f}`)}}const Le={class:"admin"},De={key:0,class:"gate"},je={class:"row"},Te={key:1,class:"section"},Oe={class:"grid"},Fe={class:"panel"},Ve={class:"list"},ze={key:0,class:"empty"},Pe={class:"meta"},$e=["title"],Be=["title"],Ue=["onClick"],Je={key:1,class:"fixed",title:"Always present"},Me={class:"panel"},He={class:"row"},We={class:"row"},Ge=["disabled"],Ke={key:0},qe={class:"row"},Qe={key:0,class:"row",style:{"margin-top":"12px"}},Ze=["disabled"],Xe=["disabled"],Ye={key:0,class:"muted"},et={key:2,class:"section"},tt={class:"panel"},st={class:"firebase-status"},ot={key:0,class:"status-badge status-online"},at={key:1,class:"status-badge status-offline"},nt={class:"muted"},lt={key:0},it={class:"shoutout-display"},rt={class:"shoutout-info"},ut={class:"date"},ct={class:"search-section"},dt={class:"row"},vt={key:0,class:"search-results"},pt=["onClick"],mt={key:1,class:"selected-section"},ft={class:"row"},ht=["value"],yt={class:"row"},gt={class:"row"},wt={key:0,class:"json-output"},bt=["value"],kt=we({__name:"Admin",setup(d){const m=r(sessionStorage.getItem("ti.admin.ok")==="1"),p=r(""),i=r(R().filter(s=>s.id.toLowerCase()!=="crepewithmarzipan")),f=r(""),V=r(""),z=r(""),P=r([]),h=r(!1);let N=null;const $=r(Re()),B=r(""),y=r(""),_=r(null),L=r(""),D=r(""),x=r([]),g=r(null),A=r(""),j=r(""),U=r(""),T=r(Ae()),q=["for their positive energy today!","for the amazing feedback!","for the loyal community support!","for the creative ideas!","for the motivating behavior!","for the helpful collaboration!","for the great contribution to the community!","for the inspiring presence!","for the engagement and enthusiasm!","for the friendly nature!"];function Q(){if(p.value===String("2410"))m.value=!0,sessionStorage.setItem("ti.admin.ok","1"),$.value&&Y();else try{window.alert("Wrong PIN")}catch{}}function O(s){return s.replace(/^@+/,"").trim()}function se(){const s=f.value.trim(),e=O(V.value);!s||!e||e.toLowerCase()!=="crepewithmarzipan"&&(G([{name:s,id:e}]),i.value=R().filter(t=>t.id.toLowerCase()!=="crepewithmarzipan"),f.value="",V.value="")}function Z(s){const t=s.split(/\r?\n/).map(u=>u.trim()).filter(u=>u.length>0),a=[],c=u=>/^[A-Za-z0-9._-]+$/.test(u);for(let u=0;u<t.length;u++){const I=t[u];if(I.includes(",")){const b=I.split(",");if(b.length===2){const k=String(b[0]??"").trim(),M=String(b[1]??"").trim(),te=O(M);if(k&&c(te)){a.push({name:k,id:te});continue}}}if(u+1<t.length){const b=t[u+1],k=O(b);if(c(k)){a.push({name:I,id:k}),u++;continue}}const J=I.split(/[\t ]+/);if(J.length>=2){const b=O(J[J.length-1]||"");if(c(b)){const k=J.slice(0,-1).join(" ").trim(),M=b;if(k&&M){a.push({name:k,id:M});continue}}}a.push({name:I,id:O(I)})}return a}function oe(){const s=Z(z.value);if(!s.length)return;const e=s.filter(t=>t.id.toLowerCase()!=="crepewithmarzipan");G(e),i.value=R().filter(t=>t.id.toLowerCase()!=="crepewithmarzipan")}function ae(){z.value=""}function ne(s){const e=s.target;P.value=Array.from(e.files||[])}async function le(){if(P.value.length){if(!N)try{N=await _e(()=>import("./index-BqeNKh0y.js").then(s=>s.i),__vite__mapDeps([0,1]))}catch{N=null}if(N){h.value=!0;try{const s=[];for(const c of P.value){const{data:u}=await N.recognize(c,"eng");s.push((u==null?void 0:u.text)||"")}const t=s.join(`
`).replace(/[@#]/g,"").replace(/[^\p{L}\p{N} _.,\n\-]/gu," "),a=Z(t);G(a),i.value=R()}finally{h.value=!1}}}}function ie(s){i.value.splice(s,1),F([{name:"crepewithmarzipan",id:"crepewithmarzipan"},...i.value])}async function re(){F(i.value),y.value="Saved locally.";try{await ue()}catch{}try{X()}catch{}}async function ue(){const s=window;if(!s.showSaveFilePicker)throw new Error("no-fs-api");const e={roster:i.value},t=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),c=await(await s.showSaveFilePicker({suggestedName:"roster.json",types:[{description:"JSON",accept:{"application/json":[".json"]}}]})).createWritable();await c.write(t),await c.close()}function ce(){i.value=[],F([])}function X(){const s={roster:i.value},e=new Blob([JSON.stringify(s,null,2)],{type:"application/json"}),t=URL.createObjectURL(e),a=document.createElement("a");a.href=t,a.download="roster.json",document.body.appendChild(a),a.click(),setTimeout(()=>{URL.revokeObjectURL(t),document.body.removeChild(a)},0)}function de(s){const e=s.target,t=e.files&&e.files[0];if(!t)return;const a=new FileReader;a.onload=()=>{try{const c=JSON.parse(String(a.result||"{}")),u=Array.isArray(c==null?void 0:c.roster)?c.roster:[];u.length&&(F(u),i.value=R())}catch{}},a.readAsText(t)}async function Y(){if($.value){h.value=!0,y.value="Loading server rosterâ€¦";try{const s=await Ee();Array.isArray(s)&&s.length?(i.value=s,F(s),y.value=`Loaded (${s.length})`):y.value="Server roster empty"}catch(s){y.value=`Error: ${(s==null?void 0:s.message)||s}`}finally{h.value=!1}}}async function ve(){if($.value){h.value=!0,y.value="Saving to serverâ€¦";try{await Ne(i.value,B.value),y.value="Saved."}catch(s){y.value=`Error: ${(s==null?void 0:s.message)||s}`}finally{h.value=!1}}}async function pe(){if(T.value)try{const s=await Se();if(s){_.value=s.shoutout,L.value=s.date;return}}catch(s){console.log("Firebase error:",s)}try{const e=await fetch("/daily-shoutout.json",{cache:"no-cache"});if(e.ok){const t=await e.json();_.value=t.shoutout,L.value=t.date}}catch{const e=localStorage.getItem("dailyShoutout");if(e)try{const t=JSON.parse(e);_.value=t.shoutout,L.value=t.date}catch{}}}function me(){const s=D.value.toLowerCase().trim();if(!s){x.value=[];return}const e=R().filter(t=>t.id.toLowerCase()!=="crepewithmarzipan");x.value=e.filter(t=>t.name.toLowerCase().includes(s)||t.id.toLowerCase().includes(s)).slice(0,10)}function fe(s){g.value=s,A.value=q[0],D.value="",x.value=[]}function ee(){g.value=null,A.value="",j.value="",D.value="",x.value=[],U.value=""}function he(){const s=(j.value||"").trim()||A.value;if(!g.value||!s)return;const t={date:new Date().toDateString(),shoutout:{name:g.value.name,reason:s,followerId:g.value.id}};U.value=JSON.stringify(t,null,2)}function ye(s){const e=s.target;e.select(),e.setSelectionRange(0,99999)}async function ge(){const s=(j.value||"").trim()||A.value;if(!g.value||!s)return;const e={name:g.value.name,reason:s,followerId:g.value.id},t=new Date().toDateString();await xe({date:t,shoutout:e})?(_.value=e,L.value=t,alert(`ðŸ”¥ Live shout-out set for ${e.name}! All users will see it instantly.`)):alert("âŒ Failed to save to Firebase. Check your connection and config."),ee()}return m.value&&pe(),(s,e)=>(l(),n("div",Le,[e[22]||(e[22]=o("h1",null,"Admin",-1)),m.value?(l(),n("section",Te,[e[16]||(e[16]=o("h2",null,"Roster",-1)),o("div",Oe,[o("div",Fe,[e[10]||(e[10]=ke('<h3 data-v-a4894e65>My profile (always present)</h3><div class="list" data-v-a4894e65><div class="item" data-v-a4894e65><div class="meta" data-v-a4894e65><strong class="name" data-v-a4894e65>crepewithmarzipan</strong><small class="id" data-v-a4894e65>crepewithmarzipan</small></div><span class="fixed" title="Always present" data-v-a4894e65>fixed</span></div></div><h3 style="margin-top:12px;" data-v-a4894e65>Others</h3>',3)),o("h3",null,"Current list ("+v(i.value.length)+")",1),o("div",Ve,[i.value.length?w("",!0):(l(),n("div",ze,"No entries yet. Add people above.")),(l(!0),n(H,null,W(i.value,(t,a)=>(l(),n("div",{key:t.id+":"+a,class:"item"},[o("div",Pe,[o("strong",{class:"name",title:t.name},v(t.name),9,$e),o("small",{class:"id",title:t.id},v(t.id),9,Be)]),t.id!=="crepewithmarzipan"?(l(),n("button",{key:0,class:"remove",onClick:c=>ie(a),title:"Remove"},"âœ•",8,Ue)):(l(),n("span",Je,"fixed"))]))),128))])]),o("div",Me,[e[11]||(e[11]=o("h3",null,"Add",-1)),o("div",He,[C(o("input",{"onUpdate:modelValue":e[1]||(e[1]=t=>f.value=t),placeholder:"Name"},null,512),[[S,f.value]]),C(o("input",{"onUpdate:modelValue":e[2]||(e[2]=t=>V.value=t),placeholder:"ID/Handle"},null,512),[[S,V.value]]),o("button",{onClick:se},"Add")]),e[12]||(e[12]=o("small",{class:"muted"},"Duplicates are removed by ID.",-1)),e[13]||(e[13]=o("h3",{style:{"margin-top":"16px"}},"Bulk",-1)),C(o("textarea",{"onUpdate:modelValue":e[3]||(e[3]=t=>z.value=t),rows:"10",placeholder:"Supported formats:\\nâ€¢ Name,ID\\nâ€¢ Name ID\\nâ€¢ Two lines: Name\\n  next line: ID\\n\\nExample:\\nAlice\\nalice_id\\n\\nBob, bob_id"},null,512),[[S,z.value]]),o("div",{class:"row"},[o("button",{onClick:oe},"Import"),o("button",{onClick:ae},"Clear")]),e[14]||(e[14]=o("h3",{style:{"margin-top":"16px"}},"OCR (screenshots)",-1)),o("div",We,[o("input",{type:"file",accept:"image/*",multiple:"",onChange:ne},null,32),o("button",{disabled:h.value||P.value.length===0,onClick:le},"Run OCR",8,Ge),h.value?(l(),n("span",Ke,"â€¦recognizingâ€¦")):w("",!0)]),o("div",{class:"row",style:{"margin-top":"12px"}},[o("button",{onClick:re},"Save"),o("button",{onClick:ce},"Clear all")]),e[15]||(e[15]=o("h3",{style:{"margin-top":"16px"}},"Export/Import JSON",-1)),o("div",qe,[o("button",{onClick:X},"Download roster.json"),o("input",{type:"file",accept:"application/json",onChange:de},null,32)]),$.value?(l(),n("div",Qe,[C(o("input",{"onUpdate:modelValue":e[4]||(e[4]=t=>B.value=t),placeholder:"Admin token (from server)"},null,512),[[S,B.value]]),o("button",{disabled:h.value,onClick:Y},"Load server",8,Ze),o("button",{disabled:h.value||!B.value,onClick:ve},"Save server",8,Xe),y.value?(l(),n("small",Ye,v(y.value),1)):w("",!0)])):w("",!0)])])])):(l(),n("div",De,[e[8]||(e[8]=o("h2",null,"Admin PIN",-1)),o("div",je,[C(o("input",{"onUpdate:modelValue":e[0]||(e[0]=t=>p.value=t),type:"password",placeholder:"PIN",onKeyup:be(Q,["enter"])},null,544),[[S,p.value]]),o("button",{onClick:Q},"Open")]),e[9]||(e[9]=o("small",{class:"muted"},'Set VITE_ADMIN_PIN in .env.local (default: "admin").',-1))])),m.value?(l(),n("section",et,[e[21]||(e[21]=o("h2",null,"Daily Shout-out",-1)),o("div",tt,[o("div",st,[T.value?(l(),n("span",ot,"ðŸ”¥ Firebase Connected")):(l(),n("span",at,"âš ï¸ Firebase Not Configured")),o("small",nt,v(T.value?"Changes sync to all users instantly":"Using local fallback - add Firebase config for real-time sync"),1)]),_.value?(l(),n("div",lt,[e[17]||(e[17]=o("h3",null,"Current Daily Shout-out",-1)),o("div",it,[o("div",rt,[o("strong",null,v(_.value.name),1),o("small",null,v(_.value.reason),1),o("small",ut,v(L.value),1)])])])):w("",!0),e[20]||(e[20]=o("h3",{style:{"margin-top":"16px"}},"Set New Shout-out",-1)),o("div",ct,[o("div",dt,[C(o("input",{"onUpdate:modelValue":e[5]||(e[5]=t=>D.value=t),placeholder:"Search follower by name...",onInput:me},null,544),[[S,D.value]])]),x.value.length?(l(),n("div",vt,[(l(!0),n(H,null,W(x.value,t=>(l(),n("div",{key:t.id,class:"search-item",onClick:a=>fe(t)},[o("strong",null,v(t.name),1),o("small",null,v(t.id),1)],8,pt))),128))])):w("",!0)]),g.value?(l(),n("div",mt,[o("h4",null,"Selected: "+v(g.value.name),1),o("div",ft,[C(o("select",{"onUpdate:modelValue":e[6]||(e[6]=t=>A.value=t)},[(l(),n(H,null,W(q,t=>o("option",{key:t,value:t},v(t),9,ht)),64))],512),[[Ce,A.value]])]),o("div",yt,[C(o("input",{"onUpdate:modelValue":e[7]||(e[7]=t=>j.value=t),placeholder:"Personal reason (optional) â€“ will override the dropdown if filled"},null,512),[[S,j.value]])]),o("div",gt,[T.value?(l(),n("button",{key:0,onClick:ge,class:"apply"},"Set Live Shout-out")):(l(),n("button",{key:1,onClick:he,class:"apply"},"Generate JSON Code")),o("button",{onClick:ee},"Cancel")]),U.value&&!T.value?(l(),n("div",wt,[e[18]||(e[18]=o("h4",null,"Copy this to public/daily-shoutout.json:",-1)),o("textarea",{readonly:"",value:U.value,onClick:ye,class:"json-code"},null,8,bt),e[19]||(e[19]=o("small",{class:"muted"},"Click textarea to select all, then Ctrl+C to copy",-1))])):w("",!0)])):w("",!0)])])):w("",!0)]))}}),St=Ie(kt,[["__scopeId","data-v-a4894e65"]]);export{St as default};
